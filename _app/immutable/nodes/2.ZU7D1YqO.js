var Gt=Object.defineProperty;var Wt=(l,t,e)=>t in l?Gt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var f=(l,t,e)=>(Wt(l,typeof t!="symbol"?t+"":t,e),e);import{s as qt,n as gt,r as zt}from"../chunks/scheduler.zMJaRgub.js";import{S as Ut,i as yt,e as b,s as W,b as it,c as g,d as x,y as ot,h as q,g as m,f as rt,o as B,p as Mt,j as U,k as C,z as K,l as Pt,A as Bt,m as Ft}from"../chunks/index.ZBQA10b7.js";function _t(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}class Yt{constructor(t){f(this,"_compare");f(this,"_elements",[]);f(this,"_size",0);this._compare=t.compare}*[Symbol.iterator](){const{_elements:t,_size:e}=this;for(let s=1;s<=e;++s)yield t[s]}init(t=[],e=0,s=t.length){if(this.clear(),e>=0&&e<s&&s<=t.length){const{_elements:n}=this;for(let o=e,i=this._size;o<s;++o)n[++i]=t[o];this._size=s-e,this._fastBuild()}}enqueue(t){this._elements[++this._size]=t,this._up(this._size)}enqueues(t,e=0,s=t.length){if(e<0&&(e=0),s>t.length&&(s=t.length),e>=s)return;const n=s-e;if(n*4<this._size){for(let i=e;i<s;++i)this.enqueue(t[i]);return}const{_elements:o}=this;for(let i=e,r=this._size;i<s;++i)o[++r]=t[i];this._size+=n,this._fastBuild()}dequeue(t){if(this._size<1){t!==void 0&&(this._size=1,this._elements[1]=t);return}const e=this._elements[1];return t!==void 0?this._elements[1]=t:this._elements[1]=this._elements[this._size--],this._down(1),e}splice(t,e=[],s=0,n=e.length){const{_size:o,_elements:i}=this;let r=0;for(let c=1;c<=o;++c){const a=i[c];t(a)&&(i[++r]=a)}if(s>=0&&s<n&&n<=e.length)for(let c=s;c<n;++c)i[++r]=e[c];this._size=r,this._fastBuild()}front(){return this._size>0?this._elements[1]:void 0}destroy(){this.clear(),this._elements=null}clear(){this._size=0}get size(){return this._size}_down(t){const{_elements:e,_size:s,_compare:n}=this;for(let o=t,i;o<=s;o=i){const r=o<<1,c=r|1;if(r>s)break;i=c<=s&&n(e[c],e[r])<0?c:r;const a=e[i];if(n(e[o],a)<=0)break;e[i]=e[o],e[o]=a}}_up(t){const{_elements:e,_compare:s}=this;for(let n=t,o;n>1;n=o){o=n>>1;const i=e[n];if(s(e[o],i)<=0)break;e[n]=e[o],e[o]=i}}_fastBuild(){for(let t=this._size>>1;t>0;--t)this._down(t)}}var N;(function(l){l[l.LEFT=0]="LEFT",l[l.TOP_LEFT=2]="TOP_LEFT",l[l.TOP=4]="TOP",l[l.TOP_RIGHT=6]="TOP_RIGHT",l[l.RIGHT=1]="RIGHT",l[l.BOTTOM_RIGHT=3]="BOTTOM_RIGHT",l[l.BOTTOM=5]="BOTTOM",l[l.BOTTOM_LEFT=7]="BOTTOM_LEFT"})(N||(N={}));const xt=Array.from(Object.entries({[N.TOP]:[-1,0],[N.TOP_RIGHT]:[-1,1],[N.RIGHT]:[0,1],[N.BOTTOM_RIGHT]:[1,1],[N.BOTTOM]:[1,0],[N.BOTTOM_LEFT]:[1,-1],[N.LEFT]:[0,-1],[N.TOP_LEFT]:[-1,-1]}).reduce((l,[t,e])=>{const s=Number(t);return l[s]=e,l},[])),Z={full:[N.LEFT,N.TOP_LEFT,N.TOP,N.TOP_RIGHT,N.RIGHT,N.BOTTOM_RIGHT,N.BOTTOM,N.BOTTOM_LEFT],leftHalf:[N.LEFT,N.TOP_LEFT,N.TOP,N.TOP_RIGHT],rightHalf:[N.RIGHT,N.BOTTOM_RIGHT,N.BOTTOM,N.BOTTOM_LEFT]},Vt={full:Z.full.reduce((l,t)=>l|1<<t,0),leftHalf:Z.leftHalf.reduce((l,t)=>l|1<<t,0),rightHalf:Z.rightHalf.reduce((l,t)=>l|1<<t,0)},z=(l,t,...e)=>{const s=new Array(t);if(e.length<=0){for(let n=0;n<t;++n)s[n]=l(n);return s}for(let n=0;n<t;++n)s[n]=z(l,...e);return s},{full:ct,rightHalf:Ct}=Z;class jt{constructor(t){f(this,"MAX_ROW");f(this,"MAX_COL");f(this,"MAX_ADJACENT");f(this,"MAX_DISTANCE_OF_NEIGHBOR");f(this,"TOTAL_PLAYER");f(this,"TOTAL_POS");f(this,"MIDDLE_POS");f(this,"board");f(this,"_idxMap");f(this,"_gomokuDirections");f(this,"_maxMovableMap");f(this,"_dirStartPosMap");f(this,"_dirStartPosSet");f(this,"_dirNeighborSet");f(this,"_neighborPlacedCount");f(this,"_rightHalfDirCountMap");f(this,"_placedCount");const{MAX_ROW:e,MAX_COL:s,MAX_ADJACENT:n,MAX_DISTANCE_OF_NEIGHBOR:o}=t,i=Math.max(1,e),r=Math.max(1,s),c=Math.max(1,n),a=Math.max(1,o),_=2,h=i*r;this.MAX_ROW=i,this.MAX_COL=r,this.MAX_ADJACENT=c,this.MAX_DISTANCE_OF_NEIGHBOR=a,this.TOTAL_PLAYER=_,this.TOTAL_POS=h,this.MIDDLE_POS=h>>1,this.board=new Array(h).fill(-1);const u=new Array(h);for(let E=0;E<i;++E)for(let v=0;v<r;++v){const M=this.idx(E,v);u[M]=[E,v]}const d=xt.map(([E,v])=>E*e+v),O=z(()=>0,ct.length,h),T=z(()=>[],ct.length),X=z(()=>0,ct.length,h);this.traverseAllDirections(E=>{const v=E^1,[M,S]=xt[E];return A=>{const[H,I]=u[A],R=H+M,p=I+S;if(R<0||R>=i||p<0||p>=i)O[E][A]=0,X[v][A]=A,T[v].push(A);else{const k=this.idx(R,p);O[E][A]=O[E][k]+1,X[v][A]=X[v][k]}}});const L=new Array(h);for(let E=0;E<h;++E){const v=[];L[E]=v;for(const M of ct){let S=E;for(let A=0;A<a&&!(1>O[M][S]);++A)S+=d[M],v.push(S)}}const F=z(()=>[],ct.length,h);this._gomokuDirections=d,this._idxMap=u,this._maxMovableMap=O,this._dirStartPosMap=X,this._dirStartPosSet=T,this._dirNeighborSet=L,this._neighborPlacedCount=new Array(h).fill(0),this._rightHalfDirCountMap=F,this._placedCount=0}get placedCount(){return this._placedCount}init(t){const e=this.board;e.fill(-1),this._placedCount=0;const{_neighborPlacedCount:s}=this;s.fill(0);for(const o of t){const i=this.idx(o.r,o.c);if(!(e[i]>=0)){e[i]=o.p,this._placedCount+=1;for(const r of this.accessibleNeighbors(i))s[r]+=1}}const{_rightHalfDirCountMap:n}=this;for(const o of Ct)for(const i of this.getStartPosSet(o)){const r=n[o][i];let c=0;const a=this.maxMovableSteps(i,o)+1;for(let _=0,h=i,u,d;_<a;_=u,h=d){const O=e[h];for(u=_+1,d=h;u<a&&(d=this.fastMoveOneStep(d,o),e[d]===O);++u);r[c++]={playerId:O,count:u-_}}r.length=c}}forward(t,e){this.board[t]=e,this._placedCount+=1;for(const s of this.accessibleNeighbors(t))this._neighborPlacedCount[s]+=1;for(const s of Ct)this._updateHalfDirCounter(e,t,s)}revert(t){this.board[t]=-1,this._placedCount-=1;for(const e of this.accessibleNeighbors(t))this._neighborPlacedCount[e]-=1;for(const e of Ct)this._updateHalfDirCounter(-1,t,e)}idx(t,e){return t*this.MAX_ROW+e}revIdx(t){return this._idxMap[t]}isValidPos(t,e){return t>=0&&t<this.MAX_ROW&&e>=0&&e<this.MAX_COL}isValidIdx(t){return t>=0&&t<this.TOTAL_POS}safeMove(t,e,s){return s<=this._maxMovableMap[e][t]?t+this._gomokuDirections[e]*s:-1}safeMoveOneStep(t,e){return 1<=this._maxMovableMap[e][t]?t+this._gomokuDirections[e]:-1}fastMove(t,e,s){return t+this._gomokuDirections[e]*s}fastMoveOneStep(t,e){return t+this._gomokuDirections[e]}maxMovableSteps(t,e){return this._maxMovableMap[e][t]}accessibleNeighbors(t){return this._dirNeighborSet[t]}hasPlacedNeighbors(t){return this._neighborPlacedCount[t]>0}couldReachFinalInDirection(t,e,s){const{MAX_ADJACENT:n,board:o}=this,i=s^1,r=this.maxMovableSteps(e,i),c=this.maxMovableSteps(e,s);if(r+c+1<n)return!1;let a=1;for(let _=e,h=0;h<r&&(_=this.fastMoveOneStep(_,i),o[_]===t);++h)a+=1;for(let _=e,h=0;h<c&&(_=this.fastMoveOneStep(_,s),o[_]===t);++h)a+=1;return a>=n}getStartPosId(t,e){return this._dirStartPosMap[e][t]}getStartPosSet(t){return this._dirStartPosSet[t]}getDirCounters(t,e){return this._rightHalfDirCountMap[e][t]}traverseAllDirections(t){const{TOTAL_POS:e}=this,{leftHalf:s,rightHalf:n}=Z;for(const o of s){const i=t(o);for(let r=0;r<e;++r)i(r)}for(const o of n){const i=t(o);for(let r=e-1;r>=0;--r)i(r)}}_updateHalfDirCounter(t,e,s){const n=s^1,o=this.getStartPosId(e,s),i=this._rightHalfDirCountMap[s][o];let r=0,c=this.maxMovableSteps(e,n)+1;for(;r<i.length;++r){const a=i[r].count;if(a>=c)break;c-=a}if(c===1)if(i[r].count===1){const a=r>0&&i[r-1].playerId===t,_=r+1<i.length&&i[r+1].playerId===t;a?_?(i[r-1].count+=1+i[r+1].count,i.splice(r,2)):(i[r-1].count+=1,i.splice(r,1)):_?(i[r+1].count+=1,i.splice(r,1)):i[r].playerId=t}else i[r].count-=1,r>0&&i[r-1].playerId===t?i[r-1].count+=1:i.splice(r,0,{playerId:t,count:1});else if(c<i[r].count){const{playerId:a,count:_}=i[r];i.splice(r,1,{playerId:a,count:c-1},{playerId:t,count:1},{playerId:a,count:_-c})}else i[r].count-=1,r+1<i.length&&i[r+1].playerId===t?i[r+1].count+=1:i.splice(r+1,0,{playerId:t,count:1})}}const{rightHalf:Et}=Z,{rightHalf:Qt}=Vt;class Jt{constructor(t){f(this,"context");f(this,"_mustWinPosSet");f(this,"_candidateCouldReachFinal");this.context=t,this._mustWinPosSet=z(()=>new Set,t.TOTAL_PLAYER),this._candidateCouldReachFinal=z(()=>0,t.TOTAL_PLAYER,t.TOTAL_POS)}init(){this._candidateCouldReachFinal.forEach(c=>c.fill(0)),this._mustWinPosSet.forEach(c=>c.clear());const{context:t}=this,{TOTAL_POS:e,board:s}=t,[n,o]=this._candidateCouldReachFinal,[i,r]=this._mustWinPosSet;for(let c=0;c<e;++c){if(s[c]>=0)continue;let a=0,_=0;for(const h of Et){const u=1<<h;t.couldReachFinalInDirection(0,c,h)&&(a|=u),t.couldReachFinalInDirection(1,c,h)&&(_|=u)}n[c]=a,o[c]=_,a>0&&i.add(c),_>0&&r.add(c)}}forward(t){this._updateRelatedCouldReachFinal(t)}revert(t){this._updateRelatedCouldReachFinal(t)}mustWinPosSet(t){return this._mustWinPosSet[t]}candidateCouldReachFinal(t,e){return this._candidateCouldReachFinal[t][e]>0}_updateRelatedCouldReachFinal(t){const{context:e}=this,{board:s}=e;this._updateCouldReachFinal(t,Qt);for(const n of Et){const o=1<<n,i=n^1,r=e.maxMovableSteps(t,i);for(let a=t,_=0;_<r;++_)if(a=e.fastMoveOneStep(a,i),s[a]<0){this._updateCouldReachFinal(a,o);break}const c=e.maxMovableSteps(t,n);for(let a=t,_=0;_<c;++_)if(a=e.fastMoveOneStep(a,n),s[a]<0){this._updateCouldReachFinal(a,o);break}}}_updateCouldReachFinal(t,e){if(e>0){const{context:s,_mustWinPosSet:n,_candidateCouldReachFinal:o}=this,i=o[0][t],r=o[1][t];if(n[0].delete(t),n[1].delete(t),s.board[t]>=0){o[0][t]=0,o[1][t]=0;return}let c=0,a=0;for(const _ of Et){const h=1<<_;h&e?(s.couldReachFinalInDirection(0,t,_)&&(c|=h),s.couldReachFinalInDirection(1,t,_)&&(a|=h)):(c|=i&h,a|=r&h)}o[0][t]=c,o[1][t]=a,c>0&&n[0].add(t),a>0&&n[1].add(t)}}}class Kt{constructor(t){f(this,"rootPlayerId");f(this,"context");f(this,"counter");f(this,"state");this.context=t.context,this.counter=t.counter,this.state=t.state,this.rootPlayerId=0}resetRootPlayerId(t){this.rootPlayerId=t&1}init(t){this.context.init(t),this.counter.init(t),this.state.init(t)}forward(t,e){const{context:s,counter:n,state:o}=this;s.board[t]<0&&(s.forward(t,e),n.forward(t,e),o.forward(t,e))}revert(t){const{context:e,counter:s,state:n}=this;e.board[t]>=0&&(e.revert(t),s.revert(t),n.revert(t))}expand(t,e,s,n){return this.state.expand(t,e,s,n)}topCandidate(t){return this.state.topCandidate(t)}score(t){return this.state.score(t^1,this.rootPlayerId)}isFinal(){return this.state.isFinal()}couldReachFinal(t){return this.counter.mustWinPosSet(t).size>0}}const{full:vt,rightHalf:st}=Z,{rightHalf:Lt}=Vt;class Zt{constructor(t){f(this,"NEXT_MOVER_BUFFER",4);f(this,"context");f(this,"counter");f(this,"scoreMap");f(this,"_candidateQueues");f(this,"_candidateInqSets");f(this,"_candidateSet");f(this,"_candidateScores");f(this,"_candidateScoreDirMap");f(this,"_candidateScoreExpired");f(this,"_stateScores");f(this,"_stateScoreDirMap");f(this,"_countOfReachFinal");f(this,"_countOfReachFinalDirMap");const{context:e,counter:s,scoreMap:n}=t,o=z(()=>new Yt({compare:(T,X)=>X.score-T.score}),e.TOTAL_PLAYER),i=z(()=>new Set,e.TOTAL_PLAYER,e.TOTAL_POS),r=new Set,c=z(()=>0,e.TOTAL_PLAYER,e.TOTAL_POS),a=z(()=>0,e.TOTAL_PLAYER,e.TOTAL_POS,vt.length),_=z(()=>Lt,e.TOTAL_POS),h=z(()=>0,e.TOTAL_PLAYER),u=z(()=>0,e.TOTAL_PLAYER,e.TOTAL_POS,vt.length),d=z(()=>0,e.TOTAL_PLAYER),O=z(()=>0,e.TOTAL_PLAYER,e.TOTAL_POS,vt.length);this.context=e,this.counter=s,this.scoreMap=n,this._candidateQueues=o,this._candidateInqSets=i,this._candidateSet=r,this._candidateScores=c,this._candidateScoreDirMap=a,this._candidateScoreExpired=_,this._stateScores=h,this._stateScoreDirMap=u,this._countOfReachFinal=d,this._countOfReachFinalDirMap=O}init(t){this._candidateQueues.forEach(c=>c.init()),this._candidateInqSets.forEach(c=>c.forEach(a=>a.clear())),this._candidateSet.clear(),this._candidateScoreExpired.fill(Lt),this._stateScores.fill(0),this._countOfReachFinal.fill(0);const{context:e,_stateScores:s,_stateScoreDirMap:n,_countOfReachFinal:o,_countOfReachFinalDirMap:i}=this;for(const c of st)for(const a of e.getStartPosSet(c)){const{score:_,countOfReachFinal:h}=this._evaluateScoreInDirection(0,a,c),{score:u,countOfReachFinal:d}=this._evaluateScoreInDirection(1,a,c);s[0]+=_,s[1]+=u,n[0][a][c]=_,n[1][a][c]=u,o[0]+=h,o[1]+=d,i[0][a][c]=h,i[1][a][c]=d}const{_candidateSet:r}=this;for(const c of t){const a=e.idx(c.r,c.c);for(const _ of e.accessibleNeighbors(a))e.board[_]<0&&r.add(_)}e.board[e.MIDDLE_POS]<0&&r.add(e.MIDDLE_POS);for(const c of r)this._reEvaluateAndEnqueueCandidate(c)}forward(t){const{context:e,_candidateSet:s}=this;s.delete(t);for(const n of e.accessibleNeighbors(t))e.board[n]<0&&s.add(n);this._updateStateScore(t),this._expireCandidates(t)}revert(t){const{context:e,_candidateSet:s}=this;e.hasPlacedNeighbors(t)&&s.add(t);for(const n of e.accessibleNeighbors(t))e.hasPlacedNeighbors(n)||s.delete(n);this._updateStateScore(t),this._expireCandidates(t),e.board[e.MIDDLE_POS]<0&&!s.has(e.MIDDLE_POS)&&(s.add(e.MIDDLE_POS),this._reEvaluateAndEnqueueCandidate(e.MIDDLE_POS))}expand(t,e,s,n=this.context.TOTAL_POS){const o=this.topCandidate(t);if(o===void 0)return 0;if(o.score===Number.MAX_VALUE)return e[0]=o,1;const i=o.score,{_candidateScoreExpired:r}=this,c=this._candidateQueues[t],a=this._candidateInqSets[t],_=this._candidateScores[t];let h=0,u;for(;h<n&&(u=c.dequeue(),u!==void 0);)if(r[u.posId]===0&&u.score===_[u.posId]){if(u.score*s<i){c.enqueue(u);break}e[h++]=u}else a[u.posId].delete(u.score);return c.size>this.context.TOTAL_POS?c.splice(d=>r[d.posId]>0||d.score!==_[d.posId]?(a[d.posId].delete(d.score),!1):!0,e,0,h):c.enqueues(e,0,h),h}topCandidate(t){const e=this.counter.mustWinPosSet(t);if(e.size>0)for(const a of e)return{posId:a,score:Number.MAX_VALUE};const s=this.counter.mustWinPosSet(t^1);if(s.size>0)for(const a of s)return{posId:a,score:Number.MAX_VALUE};const{_candidateScoreExpired:n}=this,o=this._candidateQueues[t],i=this._candidateInqSets[t],r=this._candidateScores[t];let c;for(;c=o.dequeue(),!(c===void 0||(i[c.posId].delete(c.score),n[c.posId]===0&&c.score===r[c.posId])););return c!==void 0&&(o.enqueue(c),i[c.posId].add(c.score)),c}score(t,e){const s=this._stateScores[e],n=this._stateScores[e^1],o=this.NEXT_MOVER_BUFFER;return t===e?s-n*o:s*o-n}isWin(t){return this._countOfReachFinal[t]>0}isDraw(){return this.context.placedCount===this.context.TOTAL_POS}isFinal(){const{context:t,_countOfReachFinal:e}=this;return t.placedCount===t.TOTAL_POS||e[0]>0||e[1]>0}_updateStateScore(t){const{context:e,_countOfReachFinal:s,_countOfReachFinalDirMap:n,_stateScores:o,_stateScoreDirMap:i}=this;for(const r of st){const c=e.getStartPosId(t,r),{score:a,countOfReachFinal:_}=this._evaluateScoreInDirection(0,c,r),{score:h,countOfReachFinal:u}=this._evaluateScoreInDirection(1,c,r);o[0]+=a-i[0][c][r],o[1]+=h-i[1][c][r],i[0][c][r]=a,i[1][c][r]=h,s[0]+=_-n[0][c][r],s[1]+=u-n[1][c][r],n[0][c][r]=_,n[1][c][r]=u}}_expireCandidates(t){const{context:e,_candidateSet:s,_candidateScoreExpired:n}=this;for(const o of st){const i=e.getStartPosId(t,o),r=e.maxMovableSteps(i,o),c=1<<o;for(let a=i,_=0;n[a]|=c,a!==t&&s.has(a)&&this._reEvaluateAndEnqueueCandidate(a),_!==r;++_)a=e.fastMoveOneStep(a,o)}s.has(t)&&this._reEvaluateAndEnqueueCandidate(t)}_reEvaluateAndEnqueueCandidate(t){this._reEvaluateCandidate(t);const e=this._candidateScores[0][t],s=this._candidateInqSets[0][t];s.has(e)||(s.add(e),this._candidateQueues[0].enqueue({posId:t,score:e}));const n=this._candidateScores[1][t],o=this._candidateInqSets[1][t];o.has(n)||(o.add(n),this._candidateQueues[1].enqueue({posId:t,score:n}))}_reEvaluateCandidate(t){const e=this._candidateScoreExpired[t];if(e>0){const{NEXT_MOVER_BUFFER:s,context:n,_candidateScoreDirMap:o,_stateScoreDirMap:i}=this;let r=0,c=0;for(const d of st){const O=n.getStartPosId(t,d);r+=i[0][O][d],c+=i[1][O][d]}let a=0;this._temporaryForward(t,0);for(const d of st)if(1<<d&e){const O=n.getStartPosId(t,d),{score:T}=this._evaluateScoreInDirection(0,O,d);o[0][t][d]=T,a+=T}else a+=o[0][t][d];this._temporaryRevert(t);let _=0;this._temporaryForward(t,1);for(const d of st)if(1<<d&e){const O=n.getStartPosId(t,d),{score:T}=this._evaluateScoreInDirection(1,O,d);o[1][t][d]=T,_+=T}else _+=o[1][t][d];this._temporaryRevert(t);const h=a-r,u=_-c;this._candidateScores[0][t]=h*s+u,this._candidateScores[1][t]=h+u*s,this._candidateScoreExpired[t]=0}}_evaluateScoreInDirection(t,e,s){const{context:n}=this,{con:o,gap:i}=this.scoreMap,{MAX_ADJACENT:r}=n,c=r-1,a=n.getDirCounters(e,s),_=a.length;let h=0,u=0;for(let d=0,O;d<_;d=O){for(;d<_&&a[d].playerId!==t;++d);if(d===_)break;const T=d>0&&a[d-1].playerId<0;let X=T?a[d-1].count:0;for(O=d;O<_;++O){const L=a[O].playerId;if(L>=0&&L!==t)break;X+=a[O].count}if(X>=r){const L=T?d-1:d;for(let F=d,E=-1,v=0;F<O;F+=2){F>L&&(v+=a[F-1].count);const M=F>L?1:0,S=a[F].count;if(S<c&&F+2<O&&a[F+1].count===1){F+1<O&&(v+=a[F+1].count);const A=a[F+2].count;if(A<c){const H=S+1+A,I=X-v-H,R=F+3<O?1:0,p=Math.min(S+A,c),k=i[p][M+R];k>0&&(h+=k+Math.min(v,I)),E=F+2}}if(E<F){let A=S;S>=r&&(A=r,u+=1);const H=F+1<O?1:0,I=X-v-S,R=o[A][M+H];R>0&&(h+=R+Math.min(v,I))}v+=S}}}return{score:h,countOfReachFinal:u}}_temporaryForward(t,e){this.context.forward(t,e)}_temporaryRevert(t){this.context.revert(t)}}class $t{constructor(t){f(this,"MAX_CANDIDATE_COUNT");f(this,"MIN_PROMOTION_SCORE");f(this,"CANDIDATE_GROWTH_FACTOR");f(this,"searchContext");f(this,"deeperSearcher");f(this,"_candidateCache");this.MAX_CANDIDATE_COUNT=t.MAX_CANDIDATE_COUNT,this.MIN_PROMOTION_SCORE=t.MIN_PROMOTION_SCORE,this.CANDIDATE_GROWTH_FACTOR=t.CANDIDATE_GROWTH_FACTOR,this.searchContext=t.mover,this.deeperSearcher=t.deeperSearcher,this._candidateCache=[]}search(t,e,s){const{searchContext:n,_candidateCache:o}=this,i=n.expand(t,o,this.CANDIDATE_GROWTH_FACTOR,this.MAX_CANDIDATE_COUNT);let r=o[0].posId??-1;if(i<2)return r;const c=t^1,{MIN_PROMOTION_SCORE:a,deeperSearcher:_}=this;for(let h=0;h<i;++h){const u=o[h],d=u.posId;n.forward(d,t);const O=u.score<a?n.score(c):_.search(c,e,s,1);if(n.revert(d),e<O&&(e=O,r=d),s<=e)break}return r}}class te{constructor(t){f(this,"MAX_SEARCH_DEPTH");f(this,"MIN_PROMOTION_SCORE");f(this,"mover");this.MAX_SEARCH_DEPTH=t.MAX_SEARCH_DEPTH,this.MIN_PROMOTION_SCORE=t.MIN_PROMOTION_SCORE,this.mover=t.mover}search(t,e,s,n){const{mover:o,MAX_SEARCH_DEPTH:i}=this,{rootPlayerId:r}=o;if(o.couldReachFinal(t))return t===r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(o.couldReachFinal(t^1))return t===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;const c=o.topCandidate(t);if(c===void 0)return Number.MAX_VALUE;o.forward(c.posId,t);const a=n>=i&&c.score<this.MIN_PROMOTION_SCORE?o.score(t^1):this.search(t^1,e,s,n+1);return o.revert(c.posId),a}}class ee{constructor(t){f(this,"MAX_SEARCH_DEPTH");f(this,"MAX_CANDIDATE_COUNT");f(this,"MIN_PROMOTION_SCORE");f(this,"CANDIDATE_GROWTH_FACTOR");f(this,"mover");f(this,"deeperSearcher");f(this,"_candidatesListCache");this.MAX_SEARCH_DEPTH=t.MAX_SEARCH_DEPTH,this.MAX_CANDIDATE_COUNT=t.MAX_CANDIDATE_COUNT,this.MIN_PROMOTION_SCORE=t.MIN_PROMOTION_SCORE,this.CANDIDATE_GROWTH_FACTOR=t.CANDIDATE_GROWTH_FACTOR,this.mover=t.mover,this.deeperSearcher=t.deeperSearcher,this._candidatesListCache={}}search(t,e,s,n){const{mover:o,MAX_SEARCH_DEPTH:i}=this,{rootPlayerId:r}=o;if(o.couldReachFinal(t))return t===r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(o.couldReachFinal(t^1))return t===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;if(n>i)return o.score(t);const c=this._getCandidates(n),a=o.expand(t,c,this.CANDIDATE_GROWTH_FACTOR,this.MAX_CANDIDATE_COUNT);if(a<=0)return Number.MAX_VALUE;const{MIN_PROMOTION_SCORE:_,deeperSearcher:h}=this;for(let u=0;u<a;++u){const d=c[u],O=d.posId;o.forward(O,t);const T=n>=i&&d.score>=_?h.search(t^1,e,s,1):this.search(t^1,e,s,n+1);if(o.revert(O),t===r?e<T&&(e=T):s>T&&(s=T),s<=e)break}return t===r?e:s}_getCandidates(t){let e=this._candidatesListCache[t];return e===void 0&&(e=[],this._candidatesListCache[t]=e),e}}const se=l=>{const{narrowSearcherOptions:t,deepSearcherOption:e,searchContext:s}=l;let o=new te({...e,mover:s});for(let i=t.length-1;i>=0;--i){const r=t[i];o=new ee({...r,mover:s,deeperSearcher:o})}return o},ne=(l,t,e)=>{const{MAX_ADJACENT:s,CANDIDATE_GROWTH_FACTOR:n}=e,o=[{MAX_SEARCH_DEPTH:2,MAX_CANDIDATE_COUNT:8,MIN_PROMOTION_SCORE:l.con[s-3][2]*4,CANDIDATE_GROWTH_FACTOR:n},{MAX_SEARCH_DEPTH:4,MAX_CANDIDATE_COUNT:4,MIN_PROMOTION_SCORE:l.con[s-2][1]*2,CANDIDATE_GROWTH_FACTOR:n},{MAX_SEARCH_DEPTH:8,MAX_CANDIDATE_COUNT:2,MIN_PROMOTION_SCORE:l.con[s-2][2]*4,CANDIDATE_GROWTH_FACTOR:n}],i={MAX_SEARCH_DEPTH:16,MIN_PROMOTION_SCORE:l.con[s-1][1]};return se({narrowSearcherOptions:o,deepSearcherOption:i,searchContext:t})},ie=l=>{const t=new Array(l+1).fill([]).map(()=>[0,0,0]),e=new Array(l+1).fill([]).map(()=>[0,0,0]);let s=16;const n=s*2;for(let i=1;i<l;++i,s*=16)t[i]=[0,s,s*2],e[i]=[0,s/2-n,s-n];const o=t[l-1][1];return e[l-1]=[o-n,o-n/2,o-n/4],e[l]=[o-n,o-n/2,o-n/4],t[l]=[s,s,s],{con:t,gap:e}};class oe{constructor(t){f(this,"CANDIDATE_GROWTH_FACTOR");f(this,"scoreMap");f(this,"mover");f(this,"_moverContext");f(this,"_searcher");var d;const{MAX_ROW:e,MAX_COL:s,MAX_ADJACENT:n=5,MAX_DISTANCE_OF_NEIGHBOR:o=2,CANDIDATE_GROWTH_FACTOR:i=8}=t,r=new jt({MAX_ROW:e,MAX_COL:s,MAX_ADJACENT:n,MAX_DISTANCE_OF_NEIGHBOR:o}),c=t.scoreMap??ie(r.MAX_ADJACENT),a=new Jt(r),_=new Zt({context:r,counter:a,scoreMap:c}),h=new Kt({context:r,counter:a,state:_}),u=new $t({MAX_CANDIDATE_COUNT:16,MIN_PROMOTION_SCORE:c.con[n-3][1],CANDIDATE_GROWTH_FACTOR:i,mover:h,deeperSearcher:((d=t.deeperSearcher)==null?void 0:d.call(t,h))??ne(c,h,{MAX_ADJACENT:r.MAX_ADJACENT,CANDIDATE_GROWTH_FACTOR:i})});this.CANDIDATE_GROWTH_FACTOR=i,this.mover=h,this.scoreMap=c,this._moverContext=r,this._searcher=u}init(t,e){this.mover.init(t),e!=null&&(this._searcher=e)}forward(t,e,s){const{mover:n,_moverContext:o}=this;if(o.isValidPos(t,e)){const i=o.idx(t,e);n.forward(i,s)}}revert(t,e){const{mover:s,_moverContext:n}=this;if(n.isValidPos(t,e)){const o=n.idx(t,e);s.revert(o)}}minimaxSearch(t){if(this.mover.isFinal())return[-1,-1];const{mover:e,_moverContext:s}=this;if(s.placedCount*2<s.MAX_ADJACENT){const r=[],c=Math.min(8,e.expand(t,r,1.5)),a=Math.min(c-1,Math.round(Math.random()*c)),_=r[a].posId,[h,u]=s.revIdx(_);return[h,u]}e.resetRootPlayerId(t);const n=this._searcher.search(t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,1);if(n<0)throw new Error("Oops! Something must be wrong, cannot find a valid moving strategy");const[o,i]=s.revIdx(n);return[o,i]}}function Ht(l,t,e){const s=l.slice();return s[18]=t[e],s[20]=e,s}function kt(l,t,e){const s=l.slice();return s[21]=t[e],s[23]=e,s}function re(l){let t;return{c(){t=b("div"),this.h()},l(e){t=g(e,"DIV",{class:!0}),x(t).forEach(m),this.h()},h(){B(t,"class","line vertical-line svelte-1jsic2z")},m(e,s){U(e,t,s)},d(e){e&&m(t)}}}function ce(l){let t;return{c(){t=b("div"),this.h()},l(e){t=g(e,"DIV",{class:!0}),x(t).forEach(m),this.h()},h(){B(t,"class","line horizontal-line svelte-1jsic2z")},m(e,s){U(e,t,s)},d(e){e&&m(t)}}}function ae(l){let t;return{c(){t=b("div"),this.h()},l(e){t=g(e,"DIV",{class:!0}),x(t).forEach(m),this.h()},h(){B(t,"class","stone white-stone svelte-1jsic2z")},m(e,s){U(e,t,s)},d(e){e&&m(t)}}}function le(l){let t;return{c(){t=b("div"),this.h()},l(e){t=g(e,"DIV",{class:!0}),x(t).forEach(m),this.h()},h(){B(t,"class","stone black-stone svelte-1jsic2z")},m(e,s){U(e,t,s)},d(e){e&&m(t)}}}function he(l){let t;return{c(){t=b("div"),this.h()},l(e){t=g(e,"DIV",{class:!0}),x(t).forEach(m),this.h()},h(){B(t,"class","stone purple-stone svelte-1jsic2z")},m(e,s){U(e,t,s)},d(e){e&&m(t)}}}function Xt(l){let t,e,s,n,o,i,r=l[23]<G&&re(),c=l[20]<G&&ce();function a(O,T){if(O[2]&&O[21]!==null)return he;if(O[21]===0)return le;if(O[21]===1)return ae}let _=a(l),h=_&&_(l);function u(){return l[13](l[20],l[23])}function d(...O){return l[14](l[20],l[23],...O)}return{c(){t=b("div"),r&&r.c(),e=W(),c&&c.c(),s=W(),h&&h.c(),n=W(),this.h()},l(O){t=g(O,"DIV",{class:!0,role:!0,tabindex:!0});var T=x(t);r&&r.l(T),e=q(T),c&&c.l(T),s=q(T),h&&h.l(T),n=q(T),T.forEach(m),this.h()},h(){B(t,"class","cell svelte-1jsic2z"),B(t,"role","button"),B(t,"tabindex","0")},m(O,T){U(O,t,T),r&&r.m(t,null),C(t,e),c&&c.m(t,null),C(t,s),h&&h.m(t,null),C(t,n),o||(i=[K(t,"click",u),K(t,"keydown",d)],o=!0)},p(O,T){l=O,_!==(_=a(l))&&(h&&h.d(1),h=_&&_(l),h&&(h.c(),h.m(t,n)))},d(O){O&&m(t),r&&r.d(),c&&c.d(),h&&h.d(),o=!1,zt(i)}}}function wt(l){let t,e=_t(l[18]),s=[];for(let n=0;n<e.length;n+=1)s[n]=Xt(kt(l,e,n));return{c(){for(let n=0;n<s.length;n+=1)s[n].c();t=Ft()},l(n){for(let o=0;o<s.length;o+=1)s[o].l(n);t=Ft()},m(n,o){for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(n,o);U(n,t,o)},p(n,o){if(o&101){e=_t(n[18]);let i;for(i=0;i<e.length;i+=1){const r=kt(n,e,i);s[i]?s[i].p(r,o):(s[i]=Xt(r),s[i].c(),s[i].m(t.parentNode,t))}for(;i<s.length;i+=1)s[i].d(1);s.length=e.length}},d(n){n&&m(t),Bt(s,n)}}}function _e(l){let t,e,s,n="Select Game Mode",o,i,r="One Player",c,a,_="Two Players",h,u,d,O,T,X,L,F,E,v,M="Connect Five",S,A,H=l[1]?"⚫ Black":"⚪ White",I,R,p=l[1]?"⚫":"⚪",k,dt,$,j,ft,tt,Q,J,Rt="Restart Game",ut,y,Ot,Tt,mt,et=_t(l[0]),w=[];for(let D=0;D<et.length;D+=1)w[D]=wt(Ht(l,et,D));return{c(){t=b("div"),e=b("div"),s=b("h2"),s.textContent=n,o=W(),i=b("button"),i.textContent=r,c=W(),a=b("button"),a.textContent=_,h=W(),u=b("div"),d=b("div"),O=b("div"),T=b("label"),X=it(`Blind Mode
                `),L=b("input"),F=W(),E=b("div"),v=b("h1"),v.textContent=M,S=W(),A=b("p"),I=it(H),R=it("'s turn "),k=it(p),dt=W(),$=b("div"),j=b("div");for(let D=0;D<w.length;D+=1)w[D].c();ft=W(),tt=b("div"),Q=b("div"),J=b("button"),J.textContent=Rt,ut=W(),y=b("button"),Ot=it("Undo Move"),this.h()},l(D){t=g(D,"DIV",{class:!0,style:!0});var V=x(t);e=g(V,"DIV",{class:!0});var P=x(e);s=g(P,"H2",{"data-svelte-h":!0}),ot(s)!=="svelte-1nzhiyz"&&(s.textContent=n),o=q(P),i=g(P,"BUTTON",{"data-svelte-h":!0}),ot(i)!=="svelte-15dapkn"&&(i.textContent=r),c=q(P),a=g(P,"BUTTON",{"data-svelte-h":!0}),ot(a)!=="svelte-1hdik0d"&&(a.textContent=_),P.forEach(m),V.forEach(m),h=q(D),u=g(D,"DIV",{style:!0});var nt=x(u);d=g(nt,"DIV",{class:!0});var Y=x(d);O=g(Y,"DIV",{});var pt=x(O);T=g(pt,"LABEL",{});var St=x(T);X=rt(St,`Blind Mode
                `),L=g(St,"INPUT",{type:!0}),St.forEach(m),pt.forEach(m),F=q(Y),E=g(Y,"DIV",{class:!0});var at=x(E);v=g(at,"H1",{"data-svelte-h":!0}),ot(v)!=="svelte-1hvnsvm"&&(v.textContent=M),S=q(at),A=g(at,"P",{});var lt=x(A);I=rt(lt,H),R=rt(lt,"'s turn "),k=rt(lt,p),lt.forEach(m),at.forEach(m),dt=q(Y),$=g(Y,"DIV",{class:!0});var Dt=x($);j=g(Dt,"DIV",{class:!0});var It=x(j);for(let At=0;At<w.length;At+=1)w[At].l(It);It.forEach(m),Dt.forEach(m),ft=q(Y),tt=g(Y,"DIV",{class:!0});var Nt=x(tt);Q=g(Nt,"DIV",{});var ht=x(Q);J=g(ht,"BUTTON",{"data-svelte-h":!0}),ot(J)!=="svelte-1hu6a9s"&&(J.textContent=Rt),ut=q(ht),y=g(ht,"BUTTON",{});var bt=x(y);Ot=rt(bt,"Undo Move"),bt.forEach(m),ht.forEach(m),Nt.forEach(m),Y.forEach(m),nt.forEach(m),this.h()},h(){B(e,"class","modal-content svelte-1jsic2z"),B(t,"class","modal svelte-1jsic2z"),Mt(t,"display",l[3]===null?"block":"none"),B(L,"type","checkbox"),B(E,"class","title-container svelte-1jsic2z"),B(j,"class","board svelte-1jsic2z"),B($,"class","board-container svelte-1jsic2z"),y.disabled=l[4],B(tt,"class","button-container svelte-1jsic2z"),B(d,"class","container svelte-1jsic2z"),Mt(u,"--lines",G)},m(D,V){U(D,t,V),C(t,e),C(e,s),C(e,o),C(e,i),C(e,c),C(e,a),U(D,h,V),U(D,u,V),C(u,d),C(d,O),C(O,T),C(T,X),C(T,L),L.checked=l[2],C(d,F),C(d,E),C(E,v),C(E,S),C(E,A),C(A,I),C(A,R),C(A,k),C(d,dt),C(d,$),C($,j);for(let P=0;P<w.length;P+=1)w[P]&&w[P].m(j,null);C(d,ft),C(d,tt),C(tt,Q),C(Q,J),C(Q,ut),C(Q,y),C(y,Ot),Tt||(mt=[K(i,"click",l[10]),K(a,"click",l[11]),K(L,"change",l[12]),K(J,"click",l[7]),K(y,"click",l[8])],Tt=!0)},p(D,[V]){if(V&8&&Mt(t,"display",D[3]===null?"block":"none"),V&4&&(L.checked=D[2]),V&2&&H!==(H=D[1]?"⚫ Black":"⚪ White")&&Pt(I,H),V&2&&p!==(p=D[1]?"⚫":"⚪")&&Pt(k,p),V&101){et=_t(D[0]);let P;for(P=0;P<et.length;P+=1){const nt=Ht(D,et,P);w[P]?w[P].p(nt,V):(w[P]=wt(nt),w[P].c(),w[P].m(j,null))}for(;P<w.length;P+=1)w[P].d(1);w.length=et.length}V&16&&(y.disabled=D[4])},i:gt,o:gt,d(D){D&&(m(t),m(h),m(u)),Bt(w,D),Tt=!1,zt(mt)}}}const G=11;function de(l,t,e){let s=Array(G).fill(null).map(()=>Array(G).fill(null)),n=!0,o=!1,i=null,r=!0,c=[];const a=new oe({MAX_ROW:G,MAX_COL:G});a.init([]);function _(M,S){if(!(s[M][S]!==null||r)){if(n?e(0,s[M][S]=0,s):e(0,s[M][S]=1,s),O(M,S)){alert(`${n?"Black":"White"} wins!`),e(4,r=!0),e(2,o=!1);return}if(c.length>=G*G-1){alert("It's a draw!"),e(4,r=!0),e(2,o=!1);return}if(c.push([M,S]),a.forward(M,S,n?0:1),e(1,n=!n),i&&!n){const[A,H]=a.minimaxSearch(n?1:0);_(A,H)}}}function h(M,S,A){M.key==="Enter"&&_(S,A)}function u(){!r&&!confirm("Are you sure you want to restart the game?")||(e(0,s=Array(G).fill(null).map(()=>Array(G).fill(null))),c=[],e(1,n=!0),e(4,r=!1),a.init([]))}function d(){if(c.length===0)return;const[M,S]=c.pop();a.revert(M,S),e(0,s[M][S]=null,s),e(1,n=!n),i&&!n&&d()}function O(M,S){const A=G,H=s[M][S];let I=0;for(let R=-4;R<=4;R++){const p=S+R;if(!(p<0||p>=A)&&(I=s[M][p]===H?I+1:0,I===5))return!0}I=0;for(let R=-4;R<=4;R++){const p=M+R;if(!(p<0||p>=A)&&(I=s[p][S]===H?I+1:0,I===5))return!0}I=0;for(let R=-4;R<=4;R++){const p=M+R,k=S+R;if(!(p<0||p>=A||k<0||k>=A)&&(I=s[p][k]===H?I+1:0,I===5))return!0}I=0;for(let R=-4;R<=4;R++){const p=M+R,k=S-R;if(!(p<0||p>=A||k<0||k>=A)&&(I=s[p][k]===H?I+1:0,I===5))return!0}return!1}function T(M){e(3,i=M),e(4,r=!1)}const X=()=>T(!0),L=()=>T(!1);function F(){o=this.checked,e(2,o)}return[s,n,o,i,r,_,h,u,d,T,X,L,F,(M,S)=>_(M,S),(M,S,A)=>h(A,M,S)]}class Te extends Ut{constructor(t){super(),yt(this,t,de,_e,qt,{})}}export{Te as component};
